# vi使用详解  
首先，学会用。  
**三种模式：命令行模式、末行模式、编辑模式** 。  
**三种模式之间切换**  
![vi三种模式之间切换](https://github.com/gaheadus/daily_use/blob/master/Resources/vi.png)

## 第一部分：命令模式下的操作  
任何时候，不管用户处于何种模式，只要 **按一下ESC键** ，即可进入vi **命令行模式** 。

| 移动光标的方法 ||
| --- | --- |
| 向左箭头键(←)或h | 光标向左移动一个字符 |  
| 向下箭头键(↓)或j | 光标向下移动一个字符 |  
| 向上箭头键(↑)或k | 光标向上移动一个字符 |  
| 向右箭头键(→)或i | 光标向下移动一个字符 |  
| ctrl+← | 光标向左移动一个词组(以空格分隔,一个单词,或多个字符组合) (命令行也可以ctrl+←来移动一个单词) |  
| ctrl+→ | 光标向右移动一个词组(以空格分隔,一个单词,或多个字符组合) |  
| |如果你将右手放在键盘上的话，你会发现hjkl是排列在一起的，因此可以使用这四个按键来移动光标。如果想要进行多次移动的话，例如向下移动30行，可以使用&quot;30j&quot;或&quot;30↓&quot;的组合键，即加想要进行的次数(数字)后，按下操作即可 |  
| [Ctrl]+[f] | 屏幕向下移动一页，相当于[Page Down]按键(常用) |  
| [Ctrl]+[b] | 屏幕向上移动一页，相当于[Page UP]按钮(常用) |  
| [Ctrl]+[d] | 屏幕向下移动半页 |  
| [Ctrl]+[u] | 屏幕向上移动半页 |  
| + | 光标移动到非空格符的下一行 |  
| - | 光标移动到非空格符的上一行 |  
| n&lt;space&gt; | 那个n表示&quot;数字&quot;，例如20。按下数字后再按空格键，光标会向右移动这一行的n个字符。例如20&lt;space&gt;，则光标会向后面移动20个字符距离 |  
| n[Enter] | n为数字。光标向下移动n行(常用)。n+:向上移n行，n-:向下移n行。 |  
|   0或功能键[Home] | 这是数字&quot;0&quot;：移动到这一行的最前面字符处(常用) |  
| $或功能键[End] | 移动到这一行的最后面字符处(常用) |  
| H | 光标移动到这个屏幕的最上方那一行的第一个字符 |  
| M | 光标移动到这个屏幕的中央那一行的第一个字符 |  
| L | 光标移动到这个屏幕的最下方那一行的第一个字符 |  
| gg | 移动到这个文件的第一行，连续按两次g，相当于1G(常用)。或 **:** 0/1G。 |  
| G | 大写G,即shift+g，移动光标到文件的最后一行(常用)。在末行模式下输入$，也可以跳到文件最后一行。 |  
| nG | n为数字。移动到这个文件的第n行。例如先输入120，再按shift+g，就可以调到第120行了(可配合:set nu使用，:120也可以跳到第120行) |  
| ctrl+g | 显示光标所在位置的行数和列数 |  
| **0** (零) | 将光标移至当前行的开头 |  
| **$** | 将光标移至当前行的末尾 |  
| [[和]] | 连按两次[,可以跳到上一个函数定义开始处。连按两次],… |  
| 查找与替换 ||
| /word | 向下寻找一个名称为Word的字符串。例如要在文件内查找vbird这个字符串，就输入/vbird即可(常用) |  
| ?word | 向上寻找一个字符串名称为Word的字符串 |  
| n | 这个n是英文按键。代表重复前一个查找的操作。举例来说，如果刚才我们执行/vbird去向下查找vbird这个字符串，则按下n后，会向下继续查找下一个名称为vbird的字符串。如果是执行?vbird的话，那么按下n则会向上继续查找名称为vbird的字符串 |  
| N | 这个N是英文按键。与n刚好相反，为&quot;反向&quot;进行前一个查找操作。例如输入/vbird后，按下N则表示向上查找vbird |  
| :%s/vivian/sky/g | 替换每一行中所有vivian为sky |  
| :n1,n2s/word1/word2/g | n1与n2为数字。在第n1与n2行之间寻找word1这个字符串，并将该字符串替换为word2。举例来说，在100到200行之前查找vbird并替换VBIRD则用&quot;:100,200s/vbird/VBIRD/g&quot;(常用) |  
| :1,$s/word1/word2/g | 从第一行到最后一行查找word1字符串，并将该字符串替换为word2(常用) |  
| :1,$s/word1/word2/gc | 从第一行到最后一行查找word1字符串，并将该字符串替换为word2。且在替换前显示提示字符给用户确认(confirm)是否需要替换(常用) |  
| 删除、复制与粘贴 | 这些操作可以在非编辑模式下编辑文件 |
| x,X | 在一行字当中，x为向后删除一个字符(相当于Del键)，X为向前删除一个字符(相当于Backspace)(常用) |  
| nx,nX | n为数字，nx连续向后删除n个字符，nX连续向前删除n个字符。如：删除连续10个字符，&quot;10x&quot; |  
| dd | 删除光标所在的那一整行(常用)（更确切的说是:剪切） |  
| ndd | n为数字。删除光标据的向下n行，例如20dd则是删除20行(常用) (剪切) |  
| d1G | 删除光标所在到第一行的所有数据 |  
| dG | 删除从光标所在到最后一行的所有数据 |  
| d$ | 删除从光标所在处到该行的最后一个字符 |  
| d0 | 那个是数字的0，删除从光标所在处到该行的最前面一个字符 |  
| yy | 复制光标所在的那一整行(常用) |  
| nyy | n为数字。复制光标所在的向下n行，例如20yy则是复制20行(常用) |  
| y1G | 复制光标所在行到第一行的所有数据 |  
| yG | 复制光标所在行到最后一行的所有数据 |  
| y0 | 复制光标所在的那个字符到该行行首的所有数据 |  
| y$ | 复制光标所在的那个字符到该行行尾的所有数据 |  
| p,P | p为将已复制/剪切的数据在光标下一行粘贴，P则为粘贴在光标上一行。举例来说，我目前光标在第20行，且已经复制了10行数据。则按下p后，那10行数据会粘贴在原本的20行之后，也即由21行开始粘贴。但如果是按下P呢？那么原本的第20行会被变成30行(常用) |  
| 合并、重复、取消 ||
| J | 行合并(join line)，将下一行连接到当前行的末尾，两行之间有一个空格。合并前，光标可以在当前行的任意位置。 |  
| c | 重复删除多个数据，例如向下删除10行，[10cj] |  
| u | 撤消最后一次修改，取消前一个操作(常用)，undo。 |  
| **.** | 不要怀疑，这就是 **一个小数点** 。重复最后一次修改，重复前一个操作的意思。如果你想要重复删除、重复粘贴等操作，按下小数点&quot; **.**&quot;就好了(常用)。 |  
| [ctrl]+r | 重做上一个操作(常用)，redo。如果是在编辑模式下，那么先按ESC键，然后按ctrl+r。这个功能有点说不清楚，有时候是向老版本回退，一直回退到最旧、最初、没有修改的版本，并且提示already at oldest change；有时候是向新版本更新，一直更新到最后一次修改、最新版本，并且提示already at newest change。什么时候是向老版本回退，什么时候向新版本更新？例如文件test.c，按dd删除一行，再次按dd删除一行，然后按u回退一步，再按ctrl+r，此时是往老版本回退；紧接着，如果一直回退到最旧、没有修改的版本，此时再按dd删除之前删除的一行，再按ctrl+r，此时是向新版本更新。没有文档描述ctrl+r，不清楚具体用法。在向后老版本回退时，u只能回退最后一个操作，ctrl+r可以回退多个操作，一直回退到最旧版本。 |


## 第二部分：进入编辑模式
在命令模式下输入 **插入命令i、附加命令a 、打开命令o、修改命令c、取代命令r或替换命令s** 都可进入文本输入模式。

| 进入插入或替换的编辑模式 ||
| --- | --- |
| i，I | 进入插入模式(insert mode)://inserti为从目前光标所在处插入，I为在目前所在行的第一个非空格符处开始插入(常用) |  
| a，A | 进入插入模式(insert mode)://appenda为从目前光标所在的下一个字符处开始插入，A为从光标所在行的最后一个字符处开始插入(常用) |  
| o，O | 进入插入模式(insert mode)://openo为在目前光标所在的下一行处插入新的一行;O为在目前光标所在处的上一行插入新的一行(常用) |  
| r，R | 进行替换模式(replace mode)://replacer只会替换光标所在的那一个字符一次;R会一直替换光标所在的文字，直到按下[Esc]键为止(常用) |  
| [Esc] | 退出编辑模式，回到命令行模式(即:一般模式中,常用) |

上面的这些按键中，在vi界面的左下角会出现&quot;--INSERT—&quot;或&quot;--REPLACE--&quot;的字样。由名称就知道该操作了吧。特别注意的是，我们上面也提过了，你想要在文件里面输入字符时，一定要在左下角处看到INSERT或REPLACE才能输入。

## 第三部分：末行模式下的命令
**在命令模式下，用户按&quot;:&quot;键即可进入末行模式下** ，此时会 **在显示窗口的最后一行显示一个&quot;:&quot;作为末行模式的提示符，等待用户输入命令** 。（通常也是屏幕的最后一行，所以才叫末行模式）

| 命令行的保存、离开等命令 ||
| --- | --- |
| :w | 保存，将编辑的数据写入硬盘文件中(常用)。或:update。 |  
| :w! | 若文件属性为&quot;只读&quot;时，强制写入该文件。不过，到底能不能写入，还是跟你对该文件的文件权限有关啊。感叹号(!)在vi当中经常具有&quot;强制&quot;的意思。 |  
| :q | 离开vi(常用) |  
| :q! | 若曾修改过文件，又不想存储，使用&quot;!&quot;为强制离开不保存文件 |  
| :wq | 保存后离开，若为&quot;:wq!&quot;则为强制保存后离开(常用) |  
| ZZ或:x | 这是大写的Z(shift+z)。若文件没有更改，则不保存离开，若文件已经被更改过，则保存后离开 |  
| :w[filename] | 将编辑的数据保存成另一个文件(类似于另存文件) |  
| :r[filename] | 在编辑的数据中，读入另一个文件的数据，即将&quot;filename&quot;这个文件内容加到光标所在行的后面 |  
| :n1,n2 w[filename] | 将n1到n2的内容保存成filename这个文件 |  
| :! command | 暂时离开vi到命令行模式下执行command的显示结果。例如&quot;:! ls /home&quot;即可在vi当中查看/home下面以ls输出的文件信息 |  
| :set nu、:set number | 显示行号，设置之后，会在每一行的前缀显示该行的行号。<br>*Ubuntu下vim默认显示行号，$ vim /etc/vim/vimrc //在末尾添加set number<br>cygwin默认显示行号，$ vim ~/.vimrc //在末尾添加set number* |  
| :set nonu、:set nonumber | 与set nu相反，为取消行号 |  
| :n | n为数字，跳到第n行。如，:39 [Enter]就会跳到文章的第39行。 |  
| :.= | 显示当前行的行号 |  
| := | 显示文件中的行数 |  
| :sp [filename] | 在同一编辑窗打开第二个文件(参考，第四部分:进阶和高级) |  
| ctrl+ww | 在多个编辑文件之间切换(与上面的:sp [filename]相结合) |  
| :args | 显示编辑名单中的各个文件名 |  
| ctrl+w,再按←↓↑→或hjkl | 切换到对应编辑窗口 |

特别注意，在vi中，数字是很有意义的。数字通常代表重复做几次的意思。也有可能代表去到第几个什么什么的意思。举例来说，要删除50行，则是用&quot;50dd&quot;对。数字加在操作之前，那我要向下移动20行呢？那就是&quot;20j&quot;或者是&quot;20↓&quot;即可。

## 第四部分：进阶和高级
**多文件编辑和分屏**

| 同时编辑两个文件,在两个文件中拷贝剪贴文本 ||
| --- | --- |
| vi file1 file2yy:np:N | 同时编辑两个文件(vi aa.c bb.c，会先进入aa.c编辑)在文件1的光标所在处拷贝所在行 (在aa.c)切换到文件2 (n=next) (切换到bb.c)在文件2的光标所在处粘贴所拷贝的行 (在bb.c)切换回文件1 (在aa.c) |  

| vim 分屏显示 ||
| --- | --- |
| vi -O aa.c bb.c | 左右分屏显式，ctrl+ww，子屏之间切换 |
| vi -o aa.c bb.c | 上下分屏显式 |
| vi -On file1 file2 ... | 使用大写的O参数来垂直分屏。n是数字，表示分成几个屏。 |
| vi -on file1 file2 ... | 使用小写的o参数来水平分屏 |

| 在同一编辑窗打开第二个文件，split，将同一个窗口分割成两部分，分别显式两个文件的编辑窗口 |   |
| --- | --- |  
| vi aa.c | 打开第一个文件 |
| :sp [filename]/:split filename | 在同一编辑窗打开第二个文件 (sp bb.c，光标就会移到bb.c) |
| ctrl+ww(按住ctrl,连按两次w) | 在多个编辑窗口之间切换(与上面的:sp [filename]相结合) |
| ctrl+w,再按←↓↑→或hjkl | 切换到对应的上下左右编辑窗口 |
| ctrl+w,c | 关闭当前的分屏窗口 |

| 当前文件分屏显式(同一个文件) |   |
| --- | --- |
| ctrl+w,v(常用) | 左右分屏 |
| ctrl+w,s | 上下分屏 |
| :only | 取消分屏 |

**分屏显式**  
1.vi src/com/android/contacts/dialpad/DialpadFragment.java  
2.sp src/com/android/contacts/calllog/CallLogAdapter.java//这样，光标会移到这个文件  
3.按ctrl+w，切换回DialpadFragment.java的编辑窗口  
4.按ctrl+ww(按ctrl并连按两下w)，切换回CallLogAdapter.java的编辑窗口


## 第五部分：技巧
方向键←/→左右移动一个字符,那么,如何移动一个单词呢？ ctrl+←/→。(word文档中也是这样)  