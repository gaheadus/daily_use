<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeRTOSä»å…¥é—¨åˆ°å®æˆ˜ - ä¿¡å·é‡ä¸äº’æ–¥é‡</title>
    <style>
        :root {
            --tech-blue: #3498db;
            --vitality-orange: #f39c12;
            --fresh-green: #2ecc71;
            --light-gray: #f5f7fa;
            --dark-gray: #2c3e50;
            --text-color: #333;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(135deg, var(--light-gray) 0%, #e3f2fd 100%);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            background: linear-gradient(to right, var(--tech-blue), #2980b9);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.2);
        }
        h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        main {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 6px solid var(--tech-blue);
            transition: transform 0.3s ease;
        }
        section:hover {
            transform: translateY(-5px);
        }
        h2 {
            color: var(--tech-blue);
            border-bottom: 3px solid var(--vitality-orange);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        h3 {
            color: var(--fresh-green);
            margin: 1.2rem 0 0.8rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        th {
            background-color: var(--tech-blue);
            color: white;
            padding: 1rem;
            text-align: left;
        }
        td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        ul, ol {
            padding-left: 1.5rem;
            margin: 1rem 0;
        }
        li {
            margin-bottom: 0.5rem;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1.5rem;
            border-radius: 10px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'Consolas', 'Monaco', monospace;
            border-left: 4px solid var(--vitality-orange);
        }
        .svg-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
        .highlight {
            background-color: #fff9e6;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-weight: bold;
            color: #e67e22;
        }
        .note {
            background-color: #e8f6f3;
            border-left: 4px solid var(--fresh-green);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            color: white;
            background: linear-gradient(to right, var(--dark-gray), #34495e);
            border-radius: 15px;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 5px solid;
        }
        .card-binary {
            border-top-color: var(--tech-blue);
        }
        .card-counting {
            border-top-color: var(--vitality-orange);
        }
        .card-mutex {
            border-top-color: var(--fresh-green);
        }
        .card h4 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--dark-gray);
        }
    </style>
</head>
<body>
    <header>
        <h1>FreeRTOSä»å…¥é—¨åˆ°å®æˆ˜</h1>
        <p class="subtitle">ç¬¬9è®²ï¼šä¿¡å·é‡ï¼ˆSemaphoreï¼‰ä¸äº’æ–¥é‡ï¼ˆMutexï¼‰</p>
        <p>äºŒå€¼ä¿¡å·é‡ã€è®¡æ•°ä¿¡å·é‡ã€äº’æ–¥é‡çš„æ¦‚å¿µä¸åŒºåˆ«ã€åˆ›å»ºä¸ä½¿ç”¨APIã€ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶</p>
    </header>

    <main>
        <section>
            <h2>ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸åŒºåˆ«</h2>
            <p>åœ¨FreeRTOSä¸­ï¼Œä¿¡å·é‡å’Œäº’æ–¥é‡æ˜¯ä»»åŠ¡é—´åŒæ­¥ä¸äº’æ–¥çš„å…³é”®æœºåˆ¶ã€‚å®ƒä»¬ç”¨äºåè°ƒå¤šä¸ªä»»åŠ¡å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚</p>
            
            <div class="comparison-grid">
                <div class="card card-binary">
                    <h4>ğŸ”² äºŒå€¼ä¿¡å·é‡</h4>
                    <p>ç±»ä¼¼äºä¸€ä¸ªå¼€å…³ï¼Œåªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šå¯ç”¨ï¼ˆ1ï¼‰å’Œä¸å¯ç”¨ï¼ˆ0ï¼‰ã€‚å¸¸ç”¨äºä»»åŠ¡åŒæ­¥ï¼Œå¦‚é€šçŸ¥æŸä¸ªäº‹ä»¶å·²å‘ç”Ÿã€‚</p>
                    <ul>
                        <li><strong>çŠ¶æ€</strong>ï¼š0æˆ–1</li>
                        <li><strong>å…¸å‹ç”¨é€”</strong>ï¼šä»»åŠ¡åŒæ­¥ã€äº‹ä»¶é€šçŸ¥</li>
                        <li><strong>é‡Šæ”¾è€…</strong>ï¼šä¸­æ–­æœåŠ¡ç¨‹åºæˆ–ä»»åŠ¡</li>
                    </ul>
                </div>
                <div class="card card-counting">
                    <h4>ğŸ”¢ è®¡æ•°ä¿¡å·é‡</h4>
                    <p>å¯ä»¥æ‹¥æœ‰å¤šä¸ªè®¡æ•°å€¼ï¼Œç”¨äºç®¡ç†å¤šä¸ªåŒç±»èµ„æºã€‚è®¡æ•°å€¼è¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚</p>
                    <ul>
                        <li><strong>çŠ¶æ€</strong>ï¼š0åˆ°æœ€å¤§å€¼</li>
                        <li><strong>å…¸å‹ç”¨é€”</strong>ï¼šèµ„æºæ± ç®¡ç†ã€æµé‡æ§åˆ¶</li>
                        <li><strong>é‡Šæ”¾è€…</strong>ï¼šä¸­æ–­æœåŠ¡ç¨‹åºæˆ–ä»»åŠ¡</li>
                    </ul>
                </div>
                <div class="card card-mutex">
                    <h4>ğŸ” äº’æ–¥é‡</h4>
                    <p>ç‰¹æ®Šçš„äºŒå€¼ä¿¡å·é‡ï¼Œå…·æœ‰<strong>ä¼˜å…ˆçº§ç»§æ‰¿</strong>æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤å…±äº«èµ„æºï¼Œé˜²æ­¢ä¼˜å…ˆçº§åè½¬ã€‚</p>
                    <ul>
                        <li><strong>çŠ¶æ€</strong>ï¼šé”å®šæˆ–è§£é”</li>
                        <li><strong>å…¸å‹ç”¨é€”</strong>ï¼šå…±äº«èµ„æºä¿æŠ¤</li>
                        <li><strong>é‡Šæ”¾è€…</strong>ï¼šå¿…é¡»ç”±è·å–å®ƒçš„ä»»åŠ¡é‡Šæ”¾</li>
                    </ul>
                </div>
            </div>

            <div class="svg-container">
                <svg width="800" height="300" viewBox="0 0 800 300">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2ecc71;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect x="50" y="50" width="700" height="200" rx="10" fill="url(#grad1)" opacity="0.1" stroke="#3498db" stroke-width="2"/>
                    <circle cx="150" cy="150" r="40" fill="#3498db" opacity="0.8"/>
                    <text x="150" y="155" text-anchor="middle" fill="white" font-weight="bold">ä»»åŠ¡A</text>
                    <circle cx="400" cy="150" r="60" fill="#f39c12" opacity="0.9"/>
                    <text x="400" y="155" text-anchor="middle" fill="white" font-weight="bold">å…±äº«èµ„æº</text>
                    <circle cx="650" cy="150" r="40" fill="#2ecc71" opacity="0.8"/>
                    <text x="650" y="155" text-anchor="middle" fill="white" font-weight="bold">ä»»åŠ¡B</text>
                    <path d="M190,150 L340,150" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrow)"/>
                    <path d="M460,150 L610,150" stroke="#e74c3c" stroke-width="3" marker-end="url(#arrow)"/>
                    <text x="265" y="140" fill="#c0392b" font-size="14">è·å–äº’æ–¥é‡</text>
                    <text x="535" y="140" fill="#c0392b" font-size="14">ç­‰å¾…äº’æ–¥é‡</text>
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
                        </marker>
                    </defs>
                </svg>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>äºŒå€¼ä¿¡å·é‡</th>
                        <th>è®¡æ•°ä¿¡å·é‡</th>
                        <th>äº’æ–¥é‡</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>åˆå§‹å€¼</strong></td>
                        <td>0æˆ–1</td>
                        <td>0åˆ°æœ€å¤§å€¼</td>
                        <td>1ï¼ˆå¯ç”¨ï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>ä¼˜å…ˆçº§ç»§æ‰¿</strong></td>
                        <td>æ— </td>
                        <td>æ— </td>
                        <td><strong>æœ‰</strong></td>
                    </tr>
                    <tr>
                        <td><strong>é‡Šæ”¾è€…é™åˆ¶</strong></td>
                        <td>ä»»æ„ä»»åŠ¡/ä¸­æ–­</td>
                        <td>ä»»æ„ä»»åŠ¡/ä¸­æ–­</td>
                        <td>å¿…é¡»ç”±è·å–ä»»åŠ¡é‡Šæ”¾</td>
                    </tr>
                    <tr>
                        <td><strong>ä¸»è¦ç”¨é€”</strong></td>
                        <td>ä»»åŠ¡åŒæ­¥ã€äº‹ä»¶é€šçŸ¥</td>
                        <td>èµ„æºæ± ç®¡ç†</td>
                        <td>å…±äº«èµ„æºä¿æŠ¤</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>äºŒã€åˆ›å»ºä¸ä½¿ç”¨API</h2>
            
            <h3>1. äºŒå€¼ä¿¡å·é‡</h3>
            <div class="code-block">
<pre>
// åŠ¨æ€åˆ›å»ºäºŒå€¼ä¿¡å·é‡
SemaphoreHandle_t xBinarySemaphore;
xBinarySemaphore = xSemaphoreCreateBinary();

// é™æ€åˆ›å»ºäºŒå€¼ä¿¡å·é‡
StaticSemaphore_t xSemaphoreBuffer;
SemaphoreHandle_t xBinarySemaphore;
xBinarySemaphore = xSemaphoreCreateBinaryStatic(&xSemaphoreBuffer);

// è·å–ä¿¡å·é‡ï¼ˆä»»åŠ¡ï¼‰
if(xSemaphoreTake(xBinarySemaphore, pdMS_TO_TICKS(100)) == pdTRUE) {
    // æˆåŠŸè·å–ä¿¡å·é‡
}

// é‡Šæ”¾ä¿¡å·é‡ï¼ˆä»»åŠ¡æˆ–ä¸­æ–­ï¼‰
xSemaphoreGive(xBinarySemaphore);          // ä»»åŠ¡ä¸­
xSemaphoreGiveFromISR(xBinarySemaphore, &xHigherPriorityTaskWoken); // ä¸­æ–­ä¸­
</pre>
            </div>

            <h3>2. è®¡æ•°ä¿¡å·é‡</h3>
            <div class="code-block">
<pre>
// åŠ¨æ€åˆ›å»ºè®¡æ•°ä¿¡å·é‡
SemaphoreHandle_t xCountingSemaphore;
// å‚æ•°ï¼šæœ€å¤§è®¡æ•°å€¼ï¼Œåˆå§‹è®¡æ•°å€¼
xCountingSemaphore = xSemaphoreCreateCounting(10, 0);

// é™æ€åˆ›å»ºè®¡æ•°ä¿¡å·é‡
StaticSemaphore_t xSemaphoreBuffer;
SemaphoreHandle_t xCountingSemaphore;
xCountingSemaphore = xSemaphoreCreateCountingStatic(10, 0, &xSemaphoreBuffer);

// ä½¿ç”¨æ–¹å¼ä¸äºŒå€¼ä¿¡å·é‡ç›¸åŒ
xSemaphoreTake(xCountingSemaphore, portMAX_DELAY);
xSemaphoreGive(xCountingSemaphore);
</pre>
            </div>

            <h3>3. äº’æ–¥é‡</h3>
            <div class="code-block">
<pre>
// åŠ¨æ€åˆ›å»ºäº’æ–¥é‡
SemaphoreHandle_t xMutex;
xMutex = xSemaphoreCreateMutex();

// é™æ€åˆ›å»ºäº’æ–¥é‡
StaticSemaphore_t xMutexBuffer;
SemaphoreHandle_t xMutex;
xMutex = xSemaphoreCreateMutexStatic(&xMutexBuffer);

// è·å–äº’æ–¥é‡ï¼ˆåªèƒ½ç”±ä»»åŠ¡è°ƒç”¨ï¼‰
if(xSemaphoreTake(xMutex, pdMS_TO_TICKS(1000)) == pdTRUE) {
    // è®¿é—®å…±äº«èµ„æº
    // ...
    
    // é‡Šæ”¾äº’æ–¥é‡
    xSemaphoreGive(xMutex);
}

// æ³¨æ„ï¼šäº’æ–¥é‡ä¸èƒ½åœ¨ä¸­æ–­ä¸­ä½¿ç”¨ï¼
</pre>
            </div>

            <div class="note">
                <strong>é‡è¦æç¤ºï¼š</strong>äº’æ–¥é‡å…·æœ‰ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶ï¼Œè€Œä¿¡å·é‡æ²¡æœ‰ã€‚äº’æ–¥é‡å¿…é¡»ç”±è·å–å®ƒçš„ä»»åŠ¡é‡Šæ”¾ï¼Œä¸èƒ½åœ¨ä¸­æ–­ä¸­é‡Šæ”¾ã€‚ä¿¡å·é‡å¯ä»¥åœ¨ä¸­æ–­ä¸­é‡Šæ”¾ï¼ˆä½¿ç”¨FromISRç‰ˆæœ¬ï¼‰ã€‚
            </div>
        </section>

        <section>
            <h2>ä¸‰ã€ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶</h2>
            
            <h3>ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§åè½¬ï¼Ÿ</h3>
            <p>å½“ä½ä¼˜å…ˆçº§ä»»åŠ¡æŒæœ‰å…±äº«èµ„æºï¼Œè€Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡éœ€è¦è¯¥èµ„æºæ—¶ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…ä½ä¼˜å…ˆçº§ä»»åŠ¡é‡Šæ”¾èµ„æºã€‚å¦‚æœæ­¤æ—¶æœ‰ä¸­ä¼˜å…ˆçº§ä»»åŠ¡æŠ¢å CPUï¼Œä¼šå¯¼è‡´é«˜ä¼˜å…ˆçº§ä»»åŠ¡é•¿æ—¶é—´ç­‰å¾…ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<strong>ä¼˜å…ˆçº§åè½¬</strong>ã€‚</p>
            
            <div class="svg-container">
                <svg width="800" height="400" viewBox="0 0 800 400">
                    <!-- ä¼˜å…ˆçº§åè½¬ç¤ºæ„å›¾ -->
                    <rect x="50" y="50" width="700" height="300" rx="10" fill="#f8f9fa" stroke="#ddd" stroke-width="2"/>
                    
                    <!-- æ—¶é—´çº¿ -->
                    <line x1="100" y1="100" x2="700" y2="100" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="80" y="95" fill="#7f8c8d">æ—¶é—´</text>
                    
                    <!-- é«˜ä¼˜å…ˆçº§ä»»åŠ¡ -->
                    <rect x="120" y="120" width="150" height="40" fill="#e74c3c" opacity="0.8"/>
                    <text x="195" y="145" text-anchor="middle" fill="white" font-weight="bold">é«˜ä¼˜å…ˆçº§ä»»åŠ¡</text>
                    <rect x="400" y="120" width="200" height="40" fill="#e74c3c" opacity="0.8"/>
                    
                    <!-- ä¸­ä¼˜å…ˆçº§ä»»åŠ¡ -->
                    <rect x="300" y="180" width="250" height="40" fill="#f39c12" opacity="0.8"/>
                    <text x="425" y="205" text-anchor="middle" fill="white" font-weight="bold">ä¸­ä¼˜å…ˆçº§ä»»åŠ¡</text>
                    
                    <!-- ä½ä¼˜å…ˆçº§ä»»åŠ¡ -->
                    <rect x="100" y="240" width="300" height="40" fill="#3498db" opacity="0.8"/>
                    <text x="250" y="265" text-anchor="middle" fill="white" font-weight="bold">ä½ä¼˜å…ˆçº§ä»»åŠ¡</text>
                    
                    <!-- èµ„æºå ç”¨æ ‡è®° -->
                    <rect x="120" y="240" width="100" height="40" fill="#2c3e50" opacity="0.9"/>
                    <text x="170" y="265" text-anchor="middle" fill="white" font-size="12">æŒæœ‰èµ„æº</text>
                    
                    <!-- è¯´æ˜æ–‡å­— -->
                    <text x="400" y="350" text-anchor="middle" fill="#c0392b" font-size="16" font-weight="bold">
                        ä¼˜å…ˆçº§åè½¬é—®é¢˜ï¼šé«˜ä¼˜å…ˆçº§ä»»åŠ¡è¢«ä¸­ä¼˜å…ˆçº§ä»»åŠ¡é˜»å¡
                    </text>
                    
                    <!-- ç®­å¤´æŒ‡ç¤º -->
                    <line x1="220" y1="160" x2="220" y2="240" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow2)"/>
                    <text x="240" y="200" fill="#c0392b" font-size="12">ç­‰å¾…èµ„æº</text>
                </svg>
            </div>

            <h3>ä¼˜å…ˆçº§ç»§æ‰¿å¦‚ä½•è§£å†³é—®é¢˜ï¼Ÿ</h3>
            <p>å½“é«˜ä¼˜å…ˆçº§ä»»åŠ¡ç­‰å¾…ä½ä¼˜å…ˆçº§ä»»åŠ¡æŒæœ‰çš„äº’æ–¥é‡æ—¶ï¼Œç³»ç»Ÿä¼š<strong>ä¸´æ—¶æå‡ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„ä¼˜å…ˆçº§</strong>åˆ°ä¸é«˜ä¼˜å…ˆçº§ä»»åŠ¡ç›¸åŒï¼Œä½¿å…¶èƒ½å°½å¿«æ‰§è¡Œå¹¶é‡Šæ”¾èµ„æºï¼Œä»è€Œé¿å…è¢«ä¸­ä¼˜å…ˆçº§ä»»åŠ¡æŠ¢å ã€‚</p>
            
            <ol>
                <li>ä½ä¼˜å…ˆçº§ä»»åŠ¡è·å–äº’æ–¥é‡</li>
                <li>é«˜ä¼˜å…ˆçº§ä»»åŠ¡è¯·æ±‚åŒä¸€äº’æ–¥é‡ï¼Œè¢«é˜»å¡</li>
                <li>ç³»ç»Ÿä¸´æ—¶æå‡ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„ä¼˜å…ˆçº§åˆ°ä¸é«˜ä¼˜å…ˆçº§ä»»åŠ¡ç›¸åŒ</li>
                <li>ä½ä¼˜å…ˆçº§ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œé‡Šæ”¾äº’æ–¥é‡</li>
                <li>ä½ä¼˜å…ˆçº§ä»»åŠ¡ä¼˜å…ˆçº§æ¢å¤åŸçŠ¶ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡è·å–äº’æ–¥é‡å¹¶æ‰§è¡Œ</li>
            </ol>

            <div class="code-block">
<pre>
// FreeRTOSé…ç½®ä¼˜å…ˆçº§ç»§æ‰¿
// åœ¨FreeRTOSConfig.hä¸­ç¡®ä¿ä»¥ä¸‹é…ç½®ï¼š
#define configUSE_MUTEXES                    1    // å¯ç”¨äº’æ–¥é‡
#define configUSE_PRIORITY_INHERITANCE       1    // å¯ç”¨ä¼˜å…ˆçº§ç»§æ‰¿

// ä¼˜å…ˆçº§ç»§æ‰¿æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ— éœ€é¢å¤–ä»£ç 
// å½“ä½¿ç”¨xSemaphoreCreateMutex()åˆ›å»ºçš„äº’æ–¥é‡æ—¶ï¼Œ
// ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¼˜å…ˆçº§ç»§æ‰¿
</pre>
            </div>

            <div class="note">
                <strong>æœ€ä½³å®è·µï¼š</strong>å¯¹äºå…±äº«èµ„æºçš„ä¿æŠ¤ï¼Œä¼˜å…ˆä½¿ç”¨äº’æ–¥é‡è€ŒéäºŒå€¼ä¿¡å·é‡ï¼Œå› ä¸ºäº’æ–¥é‡å…·æœ‰ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶ï¼Œå¯ä»¥é¿å…ä¼˜å…ˆçº§åè½¬é—®é¢˜ã€‚åªæœ‰åœ¨ä¸éœ€è¦ä¼˜å…ˆçº§ç»§æ‰¿çš„åŒæ­¥åœºæ™¯ä¸­ï¼Œæ‰ä½¿ç”¨äºŒå€¼ä¿¡å·é‡ã€‚
            </div>
        </section>

        <section>
            <h2>å››ã€å®æˆ˜åº”ç”¨åœºæ™¯</h2>
            
            <h3>åœºæ™¯1ï¼šä¸²å£æ•°æ®æ¥æ”¶é€šçŸ¥ï¼ˆäºŒå€¼ä¿¡å·é‡ï¼‰</h3>
            <div class="code-block">
<pre>
// ä¸²å£ä¸­æ–­æ”¶åˆ°æ•°æ®åé€šçŸ¥å¤„ç†ä»»åŠ¡
SemaphoreHandle_t xUartRxSemaphore;

void UART_IRQHandler(void) {
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;
    
    // å¤„ç†æ¥æ”¶æ•°æ®...
    
    // é‡Šæ”¾ä¿¡å·é‡é€šçŸ¥ä»»åŠ¡
    xSemaphoreGiveFromISR(xUartRxSemaphore, &xHigherPriorityTaskWoken);
    portYIELD_FROM_ISR(xHigherPriorityTaskWoken);
}

void vUartProcessTask(void *pvParameters) {
    for(;;) {
        // ç­‰å¾…ä¸²å£æ•°æ®é€šçŸ¥
        if(xSemaphoreTake(xUartRxSemaphore, portMAX_DELAY) == pdTRUE) {
            // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®
            processUartData();
        }
    }
}
</pre>
            </div>

            <h3>åœºæ™¯2ï¼šå…±äº«ç¼“å†²åŒºä¿æŠ¤ï¼ˆäº’æ–¥é‡ï¼‰</h3>
            <div class="code-block">
<pre>
// å¤šä¸ªä»»åŠ¡å…±äº«ä¸€ä¸ªæ•°æ®ç¼“å†²åŒº
SemaphoreHandle_t xBufferMutex;
uint8_t sharedBuffer[256];

void vTask1(void *pvParameters) {
    for(;;) {
        // è·å–äº’æ–¥é‡è®¿é—®å…±äº«ç¼“å†²åŒº
        if(xSemaphoreTake(xBufferMutex, pdMS_TO_TICKS(100)) == pdTRUE) {
            // å®‰å…¨åœ°è®¿é—®sharedBuffer
            writeToBuffer(sharedBuffer, data1, size1);
            
            // é‡Šæ”¾äº’æ–¥é‡
            xSemaphoreGive(xBufferMutex);
        }
        vTaskDelay(pdMS_TO_TICKS(10));
    }
}

void vTask2(void *pvParameters) {
    for(;;) {
        if(xSemaphoreTake(xBufferMutex, pdMS_TO_TICKS(100)) == pdTRUE) {
            // å®‰å…¨åœ°è®¿é—®sharedBuffer
            readFromBuffer(sharedBuffer, output, size2);
            
            xSemaphoreGive(xBufferMutex);
        }
        vTaskDelay(pdMS_TO_TICKS(15));
    }
}
</pre>
            </div>

            <h3>åœºæ™¯3ï¼šèµ„æºæ± ç®¡ç†ï¼ˆè®¡æ•°ä¿¡å·é‡ï¼‰</h3>
            <div class="code-block">
<pre>
// ç®¡ç†æœ‰é™æ•°é‡çš„ç½‘ç»œè¿æ¥
#define MAX_CONNECTIONS 5
SemaphoreHandle_t xConnectionSemaphore;
Connection_t connectionPool[MAX_CONNECTIONS];

void initConnectionPool(void) {
    // åˆå§‹æ—¶æ‰€æœ‰è¿æ¥éƒ½å¯ç”¨
    xConnectionSemaphore = xSemaphoreCreateCounting(MAX_CONNECTIONS, MAX_CONNECTIONS);
}

Connection_t* acquireConnection(void) {
    // ç­‰å¾…å¯ç”¨è¿æ¥
    if(xSemaphoreTake(xConnectionSemaphore, pdMS_TO_TICKS(5000)) == pdTRUE) {
        // æŸ¥æ‰¾å¹¶è¿”å›ä¸€ä¸ªç©ºé—²è¿æ¥
        for(int i = 0; i < MAX_CONNECTIONS; i++) {
            if(!connectionPool[i].inUse) {
                connectionPool[i].inUse = pdTRUE;
                return &connectionPool[i];
            }
        }
        // ä¸åº”è¯¥æ‰§è¡Œåˆ°è¿™é‡Œ
        xSemaphoreGive(xConnectionSemaphore);
    }
    return NULL;
}

void releaseConnection(Connection_t* conn) {
    conn->inUse = pdFALSE;
    // é‡Šæ”¾ä¸€ä¸ªè¿æ¥èµ„æº
    xSemaphoreGive(xConnectionSemaphore);
}
</pre>
            </div>
        </section>

        <section>
            <h2>äº”ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>
            
            <h3>âŒ å¸¸è§é”™è¯¯</h3>
            <ul>
                <li><span class="highlight">é”™è¯¯1ï¼š</span>åœ¨ä¸­æ–­ä¸­å°è¯•è·å–äº’æ–¥é‡ï¼ˆäº’æ–¥é‡ä¸èƒ½åœ¨ä¸­æ–­ä¸­ä½¿ç”¨ï¼‰</li>
                <li><span class="highlight">é”™è¯¯2ï¼š</span>å¿˜è®°é‡Šæ”¾äº’æ–¥é‡æˆ–ä¿¡å·é‡ï¼Œå¯¼è‡´èµ„æºæ³„æ¼</li>
                <li><span class="highlight">é”™è¯¯3ï¼š</span>ä½¿ç”¨äºŒå€¼ä¿¡å·é‡ä¿æŠ¤å…±äº«èµ„æºï¼Œå¯¼è‡´ä¼˜å…ˆçº§åè½¬</li>
                <li><span class="highlight">é”™è¯¯4ï¼š</span>åœ¨è·å–ä¿¡å·é‡æ—¶ä½¿ç”¨è¿‡çŸ­çš„è¶…æ—¶æ—¶é—´ï¼Œå¯¼è‡´ä»»åŠ¡é¢‘ç¹å”¤é†’</li>
                <li><span class="highlight">é”™è¯¯5ï¼š</span>å¤šä¸ªä»»åŠ¡ä»¥ä¸åŒé¡ºåºè·å–å¤šä¸ªäº’æ–¥é‡ï¼Œå¯¼è‡´æ­»é”</li>
            </ul>

            <h3>âœ… æœ€ä½³å®è·µ</h3>
            <ol>
                <li><strong>æ˜ç¡®ç”¨é€”ï¼š</strong>åŒæ­¥ç”¨ä¿¡å·é‡ï¼Œäº’æ–¥ç”¨äº’æ–¥é‡</li>
                <li><strong>è¶…æ—¶è®¾ç½®ï¼š</strong>åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…ä»»åŠ¡æ°¸ä¹…é˜»å¡</li>
                <li><strong>é‡Šæ”¾åŒ¹é…ï¼š</strong>ç¡®ä¿æ¯æ¬¡è·å–éƒ½æœ‰å¯¹åº”çš„é‡Šæ”¾</li>
                <li><strong>é¡ºåºä¸€è‡´ï¼š</strong>å¤šä¸ªäº’æ–¥é‡æŒ‰å›ºå®šé¡ºåºè·å–ï¼Œé¿å…æ­»é”</li>
                <li><strong>ä¸­æ–­å®‰å…¨ï¼š</strong>åœ¨ä¸­æ–­ä¸­åªä½¿ç”¨FromISRç‰ˆæœ¬çš„API</li>
                <li><strong>èµ„æºæ¸…ç†ï¼š</strong>ä»»åŠ¡åˆ é™¤å‰é‡Šæ”¾æ‰€æœ‰æŒæœ‰çš„ä¿¡å·é‡/äº’æ–¥é‡</li>
            </ol>

            <h3>ğŸ”§ è°ƒè¯•æŠ€å·§</h3>
            <div class="code-block">
<pre>
// ä½¿ç”¨FreeRTOSè·Ÿè¸ªåŠŸèƒ½è°ƒè¯•ä¿¡å·é‡
// åœ¨FreeRTOSConfig.hä¸­å¯ç”¨ï¼š
#define configUSE_TRACE_FACILITY           1
#define configUSE_STATS_FORMATTING_FUNCTIONS 1

// åœ¨ä»£ç ä¸­æŸ¥çœ‹ä¿¡å·é‡çŠ¶æ€ï¼š
void printSemaphoreInfo(SemaphoreHandle_t xSemaphore) {
    printf("ä¿¡å·é‡å¥æŸ„: %p\n", (void*)xSemaphore);
    
    // è·å–ç­‰å¾…è¯¥ä¿¡å·é‡çš„ä»»åŠ¡åˆ—è¡¨
    UBaseType_t uxArraySize = uxTaskGetNumberOfTasks();
    TaskStatus_t *pxTaskStatusArray = pvPortMalloc(uxArraySize * sizeof(TaskStatus_t));
    
    if(pxTaskStatusArray != NULL) {
        uxArraySize = uxTaskGetSystemState(pxTaskStatusArray, uxArraySize, NULL);
        
        // åˆ†æä»»åŠ¡çŠ¶æ€...
        
        vPortFree(pxTaskStatusArray);
    }
}
</pre>
            </div>
        </section>
    </main>

    <footer>
        è“æµ·èµ„æ–™æ˜é‡‘è¥
    </footer>
</body>
</html>