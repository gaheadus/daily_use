# 工具与使用  
[omnipeek](#omnipeek)  &emsp;&emsp;  [wireshark](#wireshark)  &emsp;&emsp;  [iperf](#iperf)    


## omnipeek  
[快捷键](#快捷键)  &emsp;&emsp;  [过滤器](#过滤器)  &emsp;&emsp;  [过滤条](#过滤条)    
### 快捷键    
Ctrl + N ， Creates a new capture window.  
Ctrl + O ， Opens an Omnipeek capture file or other supported file type in a new capture file window.  
Ctrl + S ， Opens the Save dialog to save all packets in the active window.  
Alt + F4 ， Quits Omnipeek.  
Ctrl + E ， 打开选择过滤条件对话框。Opens the Select dialog, where you can use filters, ASCII or hex strings, packet length, and Analysis Modules to select captured packets.  
Ctrl + H ，Removes selected packets from the display without deleting them. Hidden packets are not processed further.  
Ctrl + Shift + H ，Removes unselected packets from the display without deleting them. Hidden packets are not processed further.  
Ctrl + U ，Restores all previously hidden packets to normal status.  
Ctrl + G ，Opens the Go To dialog where you can choose a packet number to jump to. If packets are selected, the number of the first selected packet is shown.  
Ctrl + B ，Deletes all packets from the active capture window  
Ctrl + F ，Finds patterns  
Ctrl + Tab ，Makes the next window in sequence the active window.  
Ctrl + Shift + Tab ，Makes the previous window in sequence the active window.  
Ctrl + Alt + Y ，Starts all local captures.  
Ctrl + Z Undoes the last edit.  
Ctrl + X Cuts the highlighted item(s) and copies to the clipboard.  
Ctrl + C Copies highlighted item(s) to the clipboard.  
Ctrl + V Pastes the current contents of the clipboard.  


备注：  
按住ctrl、鼠标左键选择一个或多个空口log，按**ctrl+h**隐藏选择的log。  
按住shift、鼠标左键选择一个或多个空口log。  

**ctrl+shift+h**的作用和**ctrl+h**相反，隐藏没有选择的log。  
按**ctrl+u**取消隐藏。  




### 过滤器    
#### 新建过滤器    
Omnipeek自带过滤器，如Beacon/Control/DATA/DHCP/ARP等。    
也可以建立自定义的过滤器，有simple/advanced两种方式。    
1.新建一个simple的filter，名字为test。Type默认为Simple，    
![simple的filter](https://github.com/gaheadus/daily_use/blob/master/Resources/%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAsimple%E7%9A%84filter.png)    
2.新建一个advanced的filter，名字为test2。Type选择Advanced，    
![advanced的filter](https://github.com/gaheadus/daily_use/blob/master/Resources/%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAadvanced%E7%9A%84filter.png)    
点击And或Or，创建第二个过滤条件，弹出对话框如下：    
![点击And或Or](https://github.com/gaheadus/daily_use/blob/master/Resources/%E7%82%B9%E5%87%BBAnd%E6%88%96Or.png)    
得到如下过滤器，    
![得到如下过滤器](https://github.com/gaheadus/daily_use/blob/master/Resources/%E5%BE%97%E5%88%B0%E5%A6%82%E4%B8%8B%E8%BF%87%E6%BB%A4%E5%99%A8.png)    
还可以设置否定条件，点击第二个条件，再点击Not按钮，得到第二个条件的否定条件，    
![还可以设置否定条件](https://github.com/gaheadus/daily_use/blob/master/Resources/%E8%BF%98%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E5%90%A6%E5%AE%9A%E6%9D%A1%E4%BB%B6.png)    
[*返回omnipeek*](#omnipeek)    

#### 过滤器使用    
1.抓包的时候过滤    
抓包的时候选择某个过滤器，则只抓取符合过滤器条件的包；也可以不选择任何过滤器，则抓取空中的所有包。    
抓包的时候可以选择多个过滤器吗？待验证    


2.显示的时候过滤    
显示的时候选择某一个过滤器，则只显示符合过滤器条件的包。    
![择某一个过滤器](https://github.com/gaheadus/daily_use/blob/master/Resources/%E6%98%BE%E7%A4%BA%E7%9A%84%E6%97%B6%E5%80%99%E9%80%89%E6%8B%A9%E6%9F%90%E4%B8%80%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8.png)    
选择一个自己建立的过滤器，例如之前建立的名字为test的过滤器。也可以选择Omnipeek自带的过滤器。    
![选择一个自己建立的过滤器](https://github.com/gaheadus/daily_use/blob/master/Resources/%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E5%BB%BA%E7%AB%8B%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8.png)    
注意，如果想切换过滤器，比如当前显示的是management类型包，现在想显示control类型包，则必须先在过滤器上选择All Packets（ctrl+u），之后再选择control过滤器。如果没有先在过滤器上选择All Packets这个步骤，则过滤出来的包为空，也就是说之后选择的过滤器是应用在先前已选过滤之上，是二次过滤。    

可以选择多个过滤器，只要满足其中一个过滤条件就抓包。  
下图选择了三个过滤器，过滤条件为Accept only packets matching at least one of 3 filters。  
![选择多个过滤器](https://github.com/gaheadus/daily_use/blob/master/Resources/%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E5%BB%BA%E7%AB%8B%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8.png)    
[*返回omnipeek*](#omnipeek)    

#### 过滤条    
过滤条，其实就是将之前使用鼠标点击选择过滤器的操作，转化为纯文本的操作。  
过滤条可以使用表达式，可以实现比过滤器更复杂的操作，可以对显示结果进行更精确的控制。  

**1.示例**  
filter('test')  
filter('doing')  
pspec('802.11 auth') | pspec('802.11 deauth') | pspec('802.11 assoc req') | pspec('802.11 assoc rsp') | pspec('802.11 reassoc req') | pspec('802.11 reassoc rsp') | pspec('802.11 disassoc') | pspec('802.1x') | pspec('dhcp') | pspec('arp')  

可以使用& (And), | (Or), ! (Not), () (Group)等运算符。  
语法：参考omnipeek软件说明文档：omnipeek_userguide.pdf -> Creating and Using Filters  -> Creating filters with the filter bar  


**2.filter()函数**  
omnipeek软件自带过滤器、自建过滤器。  


**3.pspec()函数**  
常用过滤器名:  
802.11 control、802.11 data、802.11 management  
802.11 rts、802.11 cts、802.11 ack、802.11 ba、802.11 bar、……  
802.11 null data、802.11 qos data、802.11 a-msdu、802.1x、arp、arp request、arp response、……  
802.11 beacon、802.11 probe req、802.11 probe rsp、802.11 auth、802.11 deauth、802.11 assoc req、802.11 assoc rsp、802.11 reassoc req、802.11 reassoc rsp、802.11 disassoc、802.11 addba req、802.11 addba rsp、……  
备注：802.1x  --  eapol四次握手帧  


**4.length()函数**  
length(14) //过滤长度为14的帧，如ack、cts  
length(min: 128)  
length(max: 256)  
length(min:128,max:256)  


**5.wireless()函数**  
wireless(datarate:24) //过滤速率为24Mbps帧  
pspec('802.11 null data') & wireless(datarate:24) //过滤速率为24Mbps的null帧  

bssid过滤：  
wireless(bssid:90.B6.86.80.93.24)  


**6.addr()函数**  
mac地址过滤，  
addr(type:wireless,addr1:90.B6.86.80.93.24,addr2:40.45.DA.AA.99.FE) //注意mac地址中间用点号,不能用冒号(语法冲突)  
addr(type:wireless,addr1:90B686809324,addr2:4045DAAA99FE) //或者，直接写十六进制mac地址，中间不加任何符号  
addr(type:wireless,addr1:90.B6.86.80.93.24,addr2:40.45.DA.AA.99.FE,dir:1to2) //还可以设定addr1-addr2之间的方向，1to2、2to1、**both(默认)**。备注:*2to1不能用，软件bug*，只能将addr2、addr1位置对调，仍然使用1to2，如下：  
addr(type:wireless,addr2:90.B6.86.80.93.24,addr1:40.45.DA.AA.99.FE,dir:1to2)  

ip地址、网址过滤，  
addr(ethernet:'3com:*.*.*')、addr(type: ip, addr1: 10.4.3.1, addr2: 10.5.1.1, dir: 1to2)  


**7.通配符**  
addr(type:wireless,addr1:'90.B6.86.80.93.*',addr2:40.45.DA.AA.99.FE) //有通配符\*时需要加单引号，没有通配符时单引号可加可不加。  
addr(type:wireless,addr1:'90.B6.86.\*.\*.\*',addr2:40.45.DA.AA.99.FE)  
addr(type:wireless,addr1:'90.B6.\*.\*.\*.\*',addr2:40.45.DA.AA.99.FE)  
[*返回omnipeek*](#omnipeek)  &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)    



## wireshark  
### wireshark怎么抓包  
[*返回目录*](#工具与使用)  
原文：https://blog.csdn.net/u013258415/article/details/77877746  
在windows平台中，有两个wireshark的图标，一个是wireshark(中文版）；另外一个是wireshark legacy （英文版）。  
在这里我们选择wireshark(中文版)，英文版的参考我这个区域中其他的blog  
**设置捕获接口**  
![设置捕获接口](https://github.com/gaheadus/daily_use/blob/master/Resources/wireshark%E8%AE%BE%E7%BD%AE%E6%8D%95%E8%8E%B7%E6%8E%A5%E5%8F%A3.png)  
**停止与重新监听**  
![停止与重新监听](https://github.com/gaheadus/daily_use/blob/master/Resources/wireshark%E5%81%9C%E6%AD%A2%E4%B8%8E%E9%87%8D%E6%96%B0%E7%9B%91%E5%90%AC.png)  
**数据包的保存**  
完成数据包的捕获后，可能我们并不急着马上做分析，或者说当前能做的分析还不够完整，需要后面来加深……如此种种，我们需要用文件保存这些数据包。保存数据包也有三种方式，  
1 使用Ctrl+S组合键；  
2 菜单栏：依次点击"File"-->"Save"  
3 主工具栏 的按钮  
![数据包的保存](https://github.com/gaheadus/daily_use/blob/master/Resources/wireshark%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E4%BF%9D%E5%AD%98.png)  
[*返回wireshark*](#wireshark) &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)  

### wireshark常用选项与功能总结  
参考：https://blog.csdn.net/lhorse003/article/details/71758019  
[*返回wireshark*](#wireshark) &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)  



## iperf  
[iperf介绍](#iperf介绍)  &emsp;&emsp;&emsp;&emsp;  [iperf使用](#iperf使用)  &emsp;&emsp;&emsp;&emsp;  [参数说明](#参数说明)  &emsp;&emsp;&emsp;&emsp;  [参考网址](#参考网址)  
[*返回目录*](#工具与使用)  

### iperf介绍
**iperf官网**  
iperf下载：https://iperf.fr/    
iperf不需要安装，当需要用iperf来测试网络中两个结点间的带宽时，只需把iperf.exe文件分别copy到这两台计算机的硬盘中。使用时，直接在命令行窗口中运行带各种参数的iperf命令即可。    

**iperf介绍**  
iperf是一个网络性能测试工具，它拥有多个参数，可以测量TCP和UDP的带宽，延时抖动以及丢包率。    
带宽测试通常采用UDP模式，因为能测出极限带宽、时延抖动、丢包率。在进行测试时，首先以链路理论带宽作为数据发送速率进行测试，例如，从客户端到服务器之间的链路的理论带宽为100Mbps，先用-b 100M进行测试，然后根据测试结果（包括实际带宽，时延抖动和丢包率），再以实际带宽作为数据发送速率进行测试，会发现时延抖动和丢包率比第一次好很多，重复测试几次，就能得出稳定的实际带宽。    


### iperf使用
**TCP模式**    
服务器端：iperf -s    
客户端：iperf -c 192.168.1.1 -t 60    
在tcp模式下，客户端到服务器192.168.1.1上传带宽测试，测试时间为60秒。    
iperf -c 192.168.1.1 -P 30 -t 60    
客户端同时向服务器端发起30个连接线程。    
iperf -c 192.168.1.1 -d -t 60    
进行上下行带宽测试。  

**UDP模式**    
服务器端：iperf -u -s    
客户端：iperf -u -c 192.168.1.1 -b 100M -t 60    
在udp模式下，以100Mbps为数据发送速率，客户端到服务器192.168.1.1上传带宽测试，测试时间为60秒。    
iperf -u -c 192.168.1.1 -b 5M -P 30 -t 60    
客户端同时向服务器端发起30个连接线程，以5Mbps为数据发送速率。    
iperf -u -c 192.168.1.1 -b 100M -d -t 60    
以100M为数据发送速率，进行上下行带宽测试。  

**传文件**  
服务端：iperf -s -u  
客户端：iperf -c 192.168.100.1 -i 1 -u -t 60 -F /root/a.zip -P 5  


**iperf是client端向server端发送数据。**  
server端显示的是接收速率，最好加i参数，进行速率跟踪。  
client 显示的是发送速率。  

上行、下行  
从客户端向服务器端发送数据，对于客户端来说是上行，对于服务器端来说是下行。  
对于某个设备，如果想要测试设备的上行速率，那么设备应该作为客户端，使用iperf -c；  
测试设备的下行速率，那么设备应该作为服务器端，使用iperf -s。  



### 参数说明  
-s 以server模式启动，eg：iperf -s  
-c 以client模式启动，host是server端地址，eg：iperf -c 192.168.100.1  

通用参数  
-f [k|m|K|M] 分别表示以Kbits, Mbits, KBytes, MBytes显示报告，默认以Mbits为单位,eg:iperf -c 222.35.11.23 -f K  
-i sec 以秒为单位显示报告间隔，eg:iperf -c 192.168.100.1 -i 2。  
-l 缓冲区大小，默认是8KB,eg:iperf -c 222.35.11.23 -l 16。可以使用不同的包长，进行测试  
-m 显示tcp最大mtu值  
-o 将报告和错误信息输出到文件eg:iperf -c 222.35.11.23 -o c:iperflog.txt  
-p 指定服务器端使用的端口或客户端所连接的端口eg:iperf -s -p 9999;iperf -c 222.35.11.23 -p 9999  
-u 使用udp协议。测试htb的时候最好用udp，udp通信开销小，测试的带宽更准确  
-w 指定TCP窗口大小，默认是8KB。如果窗口太小，有可能丢包  
-B 绑定一个主机地址或接口（当主机有多个地址或接口时使用该参数）  
-C 兼容旧版本（当server端和client端版本不一样时使用）  
-M 设定TCP数据包的最大mtu值  
-N 设定TCP不延时  
-V 传输ipv6数据包  

server专用参数  
-D 以服务方式运行ipserf，eg:iperf -s -D  
-R 停止iperf服务，针对-D，eg:iperf -s -R  

client端专用参数  
-d 同时进行双向传输测试  
-n 指定传输的字节数，eg:iperf -c 222.35.11.23 -n 100000  
-r 单独进行双向传输测试  
-b 指定发送带宽，默认是1Mbit/s  
在测试qos的时候，这是最有用的参数。 
-t 测试时间，默认10秒，eg:iperf -c 222.35.11.23 -t 5  
-F 指定需要传输的文件
-T 指定ttl值  
[*返回iperf*](#iperf)  &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)  


**iperf参数详解**  
![iperf参数详解1](https://github.com/gaheadus/daily_use/blob/master/Resources/iperf%E5%8F%82%E6%95%B01.PNG)
![iperf参数详解2](https://github.com/gaheadus/daily_use/blob/master/Resources/iperf%E5%8F%82%E6%95%B02.PNG)
![iperf参数详解3](https://github.com/gaheadus/daily_use/blob/master/Resources/iperf%E5%8F%82%E6%95%B03.PNG)
![iperf参数详解4](https://github.com/gaheadus/daily_use/blob/master/Resources/iperf%E5%8F%82%E6%95%B04.PNG)
[*返回iperf*](#iperf)  &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)  


### 参考网址
https://www.cnblogs.com/Kimura/p/7514634.html

[*返回iperf*](#iperf)  &emsp;&emsp;&emsp;&emsp;  [*返回目录*](#工具与使用)  






