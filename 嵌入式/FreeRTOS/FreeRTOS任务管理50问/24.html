<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeRTOS任务管理50问 - 任务标签设置</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #e0f7fa 0%, #f9fbe7 50%, #e8f5e9 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(45deg, #4fc3f7, #81c784);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            color: white;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h2 {
            color: #2e7d32;
            border-bottom: 3px solid #81c784;
            padding-bottom: 10px;
            margin: 25px 0 15px 0;
        }
        
        h3 {
            color: #388e3c;
            margin: 20px 0 10px 0;
        }
        
        .card {
            background: #f1f8e9;
            border-left: 5px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #4caf50;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background: #f9fbe7;
        }
        
        tr:hover {
            background: #e8f5e9;
        }
        
        pre {
            background: #263238;
            color: #e0f7fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 5px solid #4fc3f7;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            color: #d32f2f;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .svg-container {
            text-align: center;
            margin: 25px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .example-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #90caf9;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #2196f3, #4caf50);
            color: white;
            border-radius: 15px;
            margin-top: 30px;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FreeRTOS任务管理50问</h1>
            <div class="subtitle">第24问：任务标签设置 - vTaskSetApplicationTaskTag函数使用</div>
        </header>
        
        <div class="content">
            <h2>任务标签概述</h2>
            <p>在FreeRTOS中，任务标签（Task Tag）是一个非常有用的功能，它允许开发者为每个任务关联一个自定义的标识值。这个标识值可以是任何32位的数据，通常用于存储任务相关的信息、状态标识或者用于调试目的。</p>
            
            <div class="card">
                <p><strong>核心概念：</strong>任务标签是一个32位的值，可以自由地关联到任务上，用于存储任务特定的信息或标识。</p>
            </div>
            
            <h2>vTaskSetApplicationTaskTag函数详解</h2>
            
            <h3>函数原型</h3>
            <pre><code>void vTaskSetApplicationTaskTag( TaskHandle_t xTask, 
                                TaskHookFunction_t pxTagValue );</code></pre>
            
            <h3>参数说明</h3>
            <table>
                <tr>
                    <th>参数</th>
                    <th>类型</th>
                    <th>描述</th>
                </tr>
                <tr>
                    <td>xTask</td>
                    <td>TaskHandle_t</td>
                    <td>要设置标签的任务句柄。使用NULL表示当前任务</td>
                </tr>
                <tr>
                    <td>pxTagValue</td>
                    <td>TaskHookFunction_t</td>
                    <td>要设置的标签值，实际上是一个32位的值</td>
                </tr>
            </table>
            
            <h3>返回值</h3>
            <p>该函数没有返回值。</p>
            
            <div class="svg-container">
                <svg width="600" height="200" viewBox="0 0 600 200">
                    <rect x="50" y="50" width="100" height="60" fill="#4fc3f7" stroke="#0277bd" stroke-width="2"/>
                    <text x="100" y="85" text-anchor="middle" fill="white" font-weight="bold">任务控制块</text>
                    
                    <rect x="200" y="40" width="150" height="80" fill="#81c784" stroke="#2e7d32" stroke-width="2"/>
                    <text x="275" y="65" text-anchor="middle" fill="white" font-weight="bold">任务标签字段</text>
                    <text x="275" y="95" text-anchor="middle" fill="white">32位自定义数据</text>
                    
                    <rect x="400" y="50" width="150" height="60" fill="#ffb74d" stroke="#f57c00" stroke-width="2"/>
                    <text x="475" y="85" text-anchor="middle" fill="white" font-weight="bold">应用数据</text>
                    
                    <path d="M150 80 L200 80" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <path d="M350 80 L400 80" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                        </marker>
                    </defs>
                </svg>
                <p><em>任务标签在任务控制块中的位置示意图</em></p>
            </div>
            
            <h2>使用场景与优势</h2>
            
            <div class="example-grid">
                <div class="example-box">
                    <h3>调试与追踪</h3>
                    <p>在调试复杂系统时，可以为每个任务设置唯一的标识符，便于在调试器中识别任务。</p>
                </div>
                
                <div class="example-box">
                    <h3>任务分类</h3>
                    <p>将任务按功能分类，使用标签标识任务类型（如UI任务、通信任务、数据处理任务等）。</p>
                </div>
                
                <div class="example-box">
                    <h3>状态存储</h3>
                    <p>存储任务的简单状态信息或配置参数，避免使用全局变量。</p>
                </div>
            </div>
            
            <h2>实际应用示例</h2>
            
            <h3>示例1：基本标签设置</h3>
            <pre><code>// 定义任务标签值
#define TASK_TAG_COMMUNICATION  ( ( TaskHookFunction_t ) 0x1001 )
#define TASK_TAG_UI             ( ( TaskHookFunction_t ) 0x1002 )
#define TASK_TAG_DATA_PROCESS   ( ( TaskHookFunction_t ) 0x1003 )

// 设置任务标签
void vSetupTaskTags(void)
{
    // 为通信任务设置标签
    vTaskSetApplicationTaskTag( xCommTaskHandle, TASK_TAG_COMMUNICATION );
    
    // 为UI任务设置标签
    vTaskSetApplicationTaskTag( xUITaskHandle, TASK_TAG_UI );
    
    // 为当前任务设置标签
    vTaskSetApplicationTaskTag( NULL, TASK_TAG_DATA_PROCESS );
}</code></pre>
            
            <h3>示例2：使用标签进行任务识别</h3>
            <pre><code>// 检查任务标签并执行相应操作
void vProcessTaskBasedOnTag( TaskHandle_t xTask )
{
    TaskHookFunction_t xTagValue;
    
    // 获取任务标签
    xTagValue = xTaskGetApplicationTaskTag( xTask );
    
    switch( (uint32_t)xTagValue )
    {
        case 0x1001:
            // 处理通信任务
            vHandleCommunicationTask();
            break;
            
        case 0x1002:
            // 处理UI任务
            vHandleUITask();
            break;
            
        case 0x1003:
            // 处理数据处理任务
            vHandleDataProcessTask();
            break;
            
        default:
            // 未知任务类型
            break;
    }
}</code></pre>
            
            <h2>相关函数</h2>
            <table>
                <tr>
                    <th>函数</th>
                    <th>描述</th>
                </tr>
                <tr>
                    <td><code>xTaskGetApplicationTaskTag</code></td>
                    <td>获取任务的标签值</td>
                </tr>
                <tr>
                    <td><code>vTaskSetApplicationTaskTag</code></td>
                    <td>设置任务的标签值</td>
                </tr>
            </table>
            
            <h2>注意事项</h2>
            <ul>
                <li>任务标签是一个32位的值，可以存储任何32位数据</li>
                <li>标签值在任务创建时默认为0</li>
                <li>使用<code>NULL</code>作为任务句柄参数表示当前任务</li>
                <li>标签值不会由FreeRTOS内核自动管理，需要应用程序负责维护</li>
                <li>在调试时，可以通过标签值快速识别任务</li>
            </ul>
            
            <div class="card">
                <p><strong>最佳实践：</strong>建议为任务标签定义有意义的枚举或宏，避免使用魔数（magic numbers），提高代码可读性和可维护性。</p>
            </div>
            
            <h2>配置要求</h2>
            <p>要使用任务标签功能，需要在FreeRTOSConfig.h中启用相关配置：</p>
            <pre><code>// 在FreeRTOSConfig.h中启用任务标签功能
#define configUSE_APPLICATION_TASK_TAG    1</code></pre>
        </div>
        
        <footer>
            蓝海资料掘金营
        </footer>
    </div>
</body>
</html>